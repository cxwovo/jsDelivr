import{r as e,w as a,j as t,o as l,c as o,a as r,q as s,E as n,g as i,s as c,u as d,l as m,h as u,x as g,z as p,F as v,f as h,t as f,m as x,D as y,d as b,p as I,b as S,k as w,n as k,e as U,v as C}from"./index-95cbf248.js";import{S as A}from"./Sidebar-bd53deae.js";import{n as j,m as q,q as L,f as _}from"./common-bd5d0c2e.js";import{L as T,a as E}from"./LazyImgJs-a4c13394.js";import{C as M,g as P,a as R,b as z,I as Q}from"./CommentEmoji-78abbca7.js";import{_ as V}from"./Pagination-afc9cb8a.js";import{u as N}from"./default-touch-d39f9990.js";import{e as H,r as B,C as D}from"./Common-e7c789d0.js";import{_ as F}from"./_plugin-vue_export-helper-1b428a4d.js";import{C as O}from"./Empty-839ee0e8.js";import"./layout-1053746e.js";const Z=e=>(I("data-v-eced30ee"),e=e(),S(),e),W={class:"blog-comment"},G={key:0},J=Z((()=>r("h2",{class:"comment-title"}," 评论区 ",-1))),K={class:"comment-form"},X={class:"comment-editor"},Y={class:"comment-textarea"},ee={class:"author-info"},ae={style:{"margin-right":"20px"}},te={class:"comment-form-input"},le={class:"comment-form-input"},oe={class:"comment-form-input"},re={style:{"text-align":"end"}},se=["src"],ne=["id"],ie={class:"author"},ce={key:0,class:"cxw-comment"},de={class:"meta"},me={class:"author-comment-time"},ue={key:0,class:"belong-place"},ge={key:1,class:"useragent-info"},pe={class:"belong-place"},ve=["src"],he={class:"belong-place"},fe=["src"],xe={class:"reply-button"},ye=["onClick"],be={class:"reply-meta"},Ie=["innerHTML"],Se={key:1,class:"blog-comment-close"},we=[Z((()=>r("i",{class:"blog icon-message-cancel"},null,-1))),Z((()=>r("span",null," 博主关闭了留言 ",-1)))],ke={name:"LeavingComment"},Ue=F(Object.assign(ke,{props:{disallow:{type:Boolean,default:!1}},setup(I){const S=e({content:"",author:localStorage.getItem("localAuthor")||"",avatar:localStorage.getItem("localAvatar")||"https://cravatar.cn/avatar/?s=256&d=monsterid",email:localStorage.getItem("localEmail")||"",authorUrl:localStorage.getItem("localAuthorUrl")||"",parentId:0}),w=I,k=e([]),U=e(!1),C=()=>{S.value={content:"",author:localStorage.getItem("localAuthor")||"",avatar:localStorage.getItem("localAvatar")||"https://cravatar.cn/avatar/?s=256&d=monsterid",email:localStorage.getItem("localEmail")||"",authorUrl:localStorage.getItem("localAuthorUrl")||"",parentId:0}};a((()=>S.value.email),((e,a)=>{if(j(e)){if(/@qq.com$/.test(e)){let a=e.substring(0,e.lastIndexOf("@"));S.value.avatar="https://q2.qlogo.cn/headimg_dl?dst_uin="+a+"&spec=100"}}}));const A=()=>{U.value=!0},L=async()=>{if(""===S.value.content)return void Qmsg.warning("评论内容不能为空");if(""===S.value.author)return void Qmsg.warning("昵称不能为空");if(""===S.value.email)return void Qmsg.warning("邮箱不能为空");new RegExp("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+.[A-Za-z]{2,}$").test(S.value.email)?(Z.value=!0,S.value.parentId=Number(localStorage.getItem("replyId")),await b.post("/view/leaving/addLeaving",S.value).then((e=>{if("200"===e.code){if(Qmsg.success(e.msg),localStorage.setItem("localAuthor",e.data.author),localStorage.setItem("localEmail",e.data.email),localStorage.setItem("localAvatar",e.data.avatar),localStorage.setItem("localAuthorUrl",e.data.authorUrl),!x.blogSetting.commentVerified){const a=Number(localStorage.getItem("replyId")),t=Number(localStorage.getItem("layers"));if(0===a&&0===t)k.value.unshift(e.data);else{let t={};for(let e=0;e<k.value.length&&(t=_(k.value[e],a),t==={}||null===t);e++);t.hasOwnProperty("children")&&void 0!==t.children&&null!==t.children||(t.children=[]),t.children.unshift(e.data)}localStorage.setItem("layers","0")}}else Qmsg.error(e.msg)})),C(),Z.value=!1):Qmsg.warning("邮箱格式不正确")},_=(e,a)=>{if(e.id===a)return e;if(e.children&&e.children.length>0)for(let t=0;t<e.children.length;t++){const l=_(e.children[t],a);if(null!==l)return l}return null},$=()=>{C(),localStorage.setItem("replyId","0"),localStorage.setItem("layers","0"),U.value=!1,document.querySelector(".comment-form").appendChild(document.querySelector(".comment-editor"))};let F=e(!0);const O=e=>{F.value=!0,e.records&&e.records.records.length>0?k.value=e.records.records:null!==e.records&&(k.value=[]),F.value=e.spinning};t((()=>{"dark"===N().getMode&&document.querySelector(".blog-comment").classList.add("dark"),localStorage.setItem("replyId","0"),localStorage.setItem("layers","0")})),a((()=>N().mode),(e=>{"dark"===e?document.querySelector(".blog-comment").classList.add("dark"):document.querySelector(".blog-comment").classList.remove("dark")}));let Z=e(!1);return(e,a)=>(l(),o("div",W,[w.disallow?(l(),o("div",Se,we)):(l(),o("div",G,[J,r("div",K,[r("div",X,[r("form",null,[r("div",Y,[s(r("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>S.value.content=e),class:"textarea"},null,512),[[n,S.value.content]]),r("label",{class:i(["textarea-label",{"textarea-label-has":S.value.content}])},"你是我一生只会遇见一次的惊喜 ...",2)]),r("div",ee,[r("div",ae,[(l(),c(T,{key:S.value.avatar,"touch-width":"40px","touch-height":"40px",type:"avatar","data-src":S.value.avatar,"onUpdate:dataSrc":a[1]||(a[1]=e=>S.value.avatar=e),"has-suffix":!1,"error-imgs":d(H)},null,8,["data-src","error-imgs"]))]),r("div",te,[s(r("input",{type:"text",required:"required","onUpdate:modelValue":a[2]||(a[2]=e=>S.value.author=e),placeholder:"* 昵称"},null,512),[[n,S.value.author]])]),r("div",le,[s(r("input",{type:"text",required:"required","onUpdate:modelValue":a[3]||(a[3]=e=>S.value.email=e),placeholder:"* 邮箱"},null,512),[[n,S.value.email]])]),r("div",oe,[s(r("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>S.value.authorUrl=e),placeholder:"个人站点"},null,512),[[n,S.value.authorUrl]])])]),m(M,{content:S.value.content,"onUpdate:content":a[5]||(a[5]=e=>S.value.content=e)},null,8,["content"]),r("div",re,[U.value?(l(),o("a",{key:0,class:"cancel-button",href:"javascript:;",onClick:$},"取消回复 ")):u("",!0),r("a",{style:g({pointerEvents:d(Z)?"none":"auto"}),class:"submit-button",href:"javascript:;",onClick:L},[d(Z)?(l(),o("img",{key:0,src:d(E),style:{width:"25px","vertical-align":"middle"},alt:""},null,8,se)):u("",!0),p(" 提交 ")],4)])])])]),r("div",null,[d(F)?u("",!0):(l(!0),o(v,{key:0},h(k.value,(e=>(l(),o("div",{key:e.id,id:"comment-"+e.id,class:"reply-contain"},[r("div",ie,[r("div",null,[m(T,{style:{"margin-right":"10px","vertical-align":"middle"},"touch-width":"40px","touch-height":"40px","data-src":e.avatar,type:"avatar","has-suffix":!1,"error-imgs":d(H)},null,8,["data-src","error-imgs"]),e.admin?(l(),o("span",ce," 博主 ")):u("",!0),r("span",null,f(e.author),1)]),r("div",de,[r("div",me,[p(f(d(q)(e.createTime))+" ",1),d(x).themeConfig.enableCommentUa&&e.belongPlace?(l(),o("span",ue,f(e.belongPlace),1)):u("",!0),d(x).themeConfig.enableCommentUa&&e.userAgent?(l(),o("span",ge,[r("span",pe,[r("img",{src:d(P)(d(R)(e.userAgent)),onerror:"this.src=getUnknownImg()",alt:"ua-browser"},null,8,ve),p(" "+f(d(R)(e.userAgent).browserName)+" "+f(d(R)(e.userAgent).browserVersion),1)]),r("span",he,[r("img",{src:d(z)(d(R)(e.userAgent)),onerror:"this.src=getUnknownImg()",alt:"ua-os"},null,8,fe),p(" "+f(d(R)(e.userAgent).osName)+" "+f(d(R)(e.userAgent).osVersion),1)])])):u("",!0)]),r("div",xe,[r("a",{href:"javascript:;",onClick:y((a=>{return t=e.id,C(),U.value=!0,localStorage.setItem("replyId",t),void document.querySelector("#comment-"+t).appendChild(document.querySelector(".comment-editor"));var t}),["stop"])},"回复",8,ye)])]),r("div",be,[r("p",{innerHTML:d(B)(e.content,"comment")},null,8,Ie)])]),m(Q,{onShowCancelReply:A,"reply-list":e.children,"parent-name":e.author},null,8,["reply-list","parent-name"])],8,ne)))),128)),w.disallow?u("",!0):(l(),c(V,{key:1,requestPath:"/view/leaving/findPageLeavingForWeb",onGetData:O}))]),m(D,{loading:d(F)},null,8,["loading"])]))]))}}),[["__scopeId","data-v-eced30ee"]]),Ce={class:"index-contain"},Ae={class:"page-contain"},je={class:"box-contain"},qe={class:"leaving"},Le=(e=>(I("data-v-5a52eadf"),e=e(),S(),e))((()=>r("div",{class:"leaving-title"}," 留言 ",-1))),_e={key:0,class:"leaving-list"},Te={class:"item"},$e={class:"user"},Ee={class:"nickname"},Me={class:"data"},Pe={class:"wrapper"},Re={class:"content leaving-content"},ze=["innerHTML"],Qe={class:"load-div"},Ve={key:1},Ne=F({__name:"Leaving",setup(a){const n=e([]),c=e(!1),p=e(!1),y=()=>{let e=100;const a=["#dcc10c","#299bec","#ea5455","#7367f0","#32ccbb","#f6416c","#28c76f","#9f44d3","#f55555","#736efe","#e96d71","#de4313","#d939cd","#4c83ff","#f072b6","#c346c2","#5961f9","#fd6585","#465efb","#ffc600","#fa742b","#5151e5","#bb4e75","#e255cd","#63c549","#0ecdde","#f067b4","#f067b4","#ff9a9e","#1dd5de","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"],t=(e,a)=>Math.floor(Math.random()*(a-e+1))+e,l=$(".leaving-list"),o=l.width(),r=l.height(),s=["20px 300px","20px 400px","20px 500px","30px 300px","30px 400px","30px 500px","40px 300px","40px 400px","40px 500px"],n=["300px 20px","400px 20px","500px 20px","300px 30px","400px 30px","500px 30px","300px 40px","400px 40px","500px 40px"];$(".leaving-list .item").each(((l,i)=>{const c=t(1,99),d=a[t(0,a.length-1)],m=Math.ceil($(i).width()),u=Math.ceil($(i).height()),g=t(0,r-u),p=t(0,o-m);$(i).css({display:"block",zIndex:c,background:d,top:g,left:p,borderTopLeftRadius:n[t(0,n.length-1)],borderTopRightRadius:s[t(0,s.length-1)],borderBottomLeftRadius:s[t(0,s.length-1)],borderBottomRightRadius:s[t(0,s.length-1)]}),$(i).draggabilly({containment:!0}),$(i).on("dragStart",(a=>{e++,$(i).css({zIndex:e})}))})),c.value=!0};return w((async()=>{await b.get("/view/leaving/getLeavingTopForWeb").then((e=>{"200"===e.code?(n.value=e.data,n.value&&n.value.length||(p.value=!0)):Qmsg.error(e.msg)})),await k((()=>{U().setIsLoaded(!0)}))})),t((()=>{p.value||k((async()=>{await Utils.sleep(300),L(Utils.getStaticUrl("draggabilly/draggabilly.min.js"),y)}))})),(e,a)=>(l(),o("div",{class:i(["index-main",{showInUp:d(x).themeConfig.enableShowInUp}]),style:g({flexDirection:"left"===d(x).themeConfig.asidePosition?"row-reverse":""})},[r("div",Ce,[r("div",Ae,[r("div",je,[r("div",qe,[Le,d(p)?u("",!0):(l(),o("ul",_e,[(l(!0),o(v,null,h(d(n),(e=>s((l(),o("li",Te,[r("div",$e,[m(T,{type:"avatar","data-src":e.avatar,"touch-width":"20px","touch-height":"20px"},null,8,["data-src"]),r("div",Ee,f(e.author),1),r("div",Me,f(d(_)(e.createTime)),1)]),r("div",Pe,[r("div",Re,[r("p",{innerHTML:d(B)(e.content,"comment")},null,8,ze)])])],512)),[[C,d(c)]]))),256)),r("div",Qe,[m(D,{loading:!d(c)},null,8,["loading"])])])),d(p)?(l(),o("div",Ve,[m(O,{description:d(x).themeConfig.leavingEmptyText||"暂无留言，期待第一个脚印。"},null,8,["description"])])):u("",!0)])])]),m(Ue,{style:{"margin-top":"15px"}})]),m(A,{class:i({"index-sidebar":"left"===d(x).themeConfig.asidePosition})},null,8,["class"])],6))}},[["__scopeId","data-v-5a52eadf"]]);export{Ne as default};
